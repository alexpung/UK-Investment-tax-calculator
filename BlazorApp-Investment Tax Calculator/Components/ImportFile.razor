@using Model.Interfaces;
@using Syncfusion.Blazor.Inputs
@using Microsoft.AspNetCore.Components.Forms;
@using Model;
@using Parser;

@inject TaxEventLists taxEventLists;
@inject FileParseController fileParseController;

<p>Import and Export</p>

<p>Load Options</p>
<AssetTypeToLoad></AssetTypeToLoad>

<p>Import Files</p>
<p>
    <SfUploader AutoUpload="false">
        <UploaderEvents ValueChange="LoadFiles"></UploaderEvents>
    </SfUploader>
</p>
<p>Import Folders</p>
<p>
<SfUploader ID="UploadFiles" AutoUpload=false DirectoryUpload=true>
        <UploaderEvents ValueChange="LoadFiles"></UploaderEvents>
</SfUploader>
</p>
<p> Number of tax events: @taxEventLists.GetTotalNumberOfEvents()</p>
<p> Number of dividends imported: @taxEventLists.Dividends.Count</p>
<p> Number of trades imported: @taxEventLists.Trades.Count</p>
<p> Number of corporate actions imported: @taxEventLists.CorporateActions.Count</p>

@code {
    private async Task LoadFiles(UploadChangeEventArgs args)
    {
        foreach (var file in args.Files)
        {
            taxEventLists.AddData(await fileParseController.ReadFile(file.File));
        }
        args.Files.Clear();
    }
}
