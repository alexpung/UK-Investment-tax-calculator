@using Syncfusion.Blazor.Navigations
@inject NavigationManager Navigation
@implements IDisposable

<nav class="d-flex flex-column gap-3 p-3">
    <div class="text-uppercase text-secondary small fw-semibold px-3">Navigation</div>
    <div class="list-group list-group-flush">
        @foreach (var entry in List)
        {
            <button type="button"
                    class="list-group-item list-group-item-action @GetActiveClass(entry.PageAddress)"
                    @onclick="() => NavigateTo(entry.PageAddress)">
                @entry.Text
            </button>
        }
    </div>
    <div class="mt-3 px-3">
        <div class="text-secondary small">Data never leaves your browser.</div>
    </div>
</nav>

@code {
    // Specify the value of ListView component DataSource property.
    public List<ListData> List { get; set; } = new List<ListData>
    {
        new ListData {Id="1", Text = "Home", PageAddress = ""},
        new ListData {Id="2",Text = "Import/Export", PageAddress = "MainCalculatorPage"},
        new ListData {Id="3",Text = "CGT Yearly Summary", PageAddress = "CgtYearlyTaxSummaryPage"},
        new ListData {Id="4",Text = "Dividend/income Summary", PageAddress = "DividendYearlyTaxSummaryPage"},
        new ListData {Id="5",Text = "Disposal Summary", PageAddress = "CalculationViewPage"},
        new ListData {Id="6", Text = "Trade Matches", PageAddress = "TradeMatchPage"},
        new ListData {Id="7", Text = "Dividend/income Data", PageAddress = "DividendDataPage"},
        new ListData {Id="8", Text = "Section 104 Data", PageAddress = "Section104DataPage"},
        new ListData {Id="9", Text = "Add Trades", PageAddress = "AddTradePage"},
        new ListData {Id="10", Text = "Conversion", PageAddress = "ConvertPage"},
        new ListData {Id="11", Text = "PDF Report", PageAddress = "PdfReportPage"},
        new ListData {Id="12", Text = "Residency Status", PageAddress = "ResidencyStatusPage"},
        new ListData {Id="13", Text = "ERI and Equalisation", PageAddress = "AddExcessReportableIncome"},
        new ListData {Id="15", Text = "Corporate Actions", PageAddress = "corporate-actions"},
        new ListData {Id="14", Text = "Acknowledgement", PageAddress = "AcknowledgementPage"}
        ,
    };

    public class ListData
    {
        public required string Id { get; set; }
        public required string Text { get; set; }
        public required string PageAddress { get; set; }
    }

    protected override void OnInitialized()
    {
        Navigation.LocationChanged += HandleLocationChanged;
    }

    private void HandleLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs args)
    {
        StateHasChanged();
    }

    private void NavigateTo(string pageAddress)
    {
        Navigation.NavigateTo(pageAddress);
    }

    private string GetActiveClass(string pageAddress)
    {
        var current = Navigation.ToBaseRelativePath(Navigation.Uri);
        if (string.IsNullOrWhiteSpace(current))
        {
            return pageAddress == string.Empty ? "active" : string.Empty;
        }

        return current.Equals(pageAddress, StringComparison.OrdinalIgnoreCase) ? "active" : string.Empty;
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= HandleLocationChanged;
    }
}
